<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-i18n-key="purchase-orders-header">Purchase Orders</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="../css/app.css" rel="stylesheet">
</head>
<body>
  <!-- Language selector and voice command -->
  <div class="container py-2 d-flex justify-content-end">
    <select id="langSelector" class="form-select form-select-sm w-auto me-2">
      <option value="en">English</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="he">◊¢◊ë◊®◊ô◊™</option>
    </select>
    <button class="btn btn-outline-primary btn-sm" onclick="startVoiceCommand()">üé§ Voice</button>
  </div>
  <div class="container py-4">
    <h1 class="mb-4" data-i18n-key="purchase-orders-header">Purchase Orders</h1>
    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#poModal" data-i18n-key="add-purchase-order">Add Purchase Order</button>
    <table class="table table-bordered responsive-table">
      <thead>
        <tr>
          <th>#</th>
          <th data-i18n-key="vendor-name">Vendor</th>
          <th>Date</th>
          <th>Items</th>
          <th>Organic</th>
        </tr>
      </thead>
      <tbody id="purchaseTableBody"></tbody>
    </table>
  </div>
  <!-- Purchase Order Modal -->
  <div class="modal fade" id="poModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" data-i18n-key="add-purchase-order">Add Purchase Order</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label for="poVendor" class="form-label" data-i18n-key="vendor-name">Vendor Name</label>
              <select class="form-select" id="poVendor"></select>
            </div>
            <div class="col-md-6">
              <label for="poDate" class="form-label">Date</label>
              <input type="date" class="form-control" id="poDate">
            </div>
          </div>
          <hr>
          <h6>Items</h6>
          <div id="itemInputs" class="row g-3 align-items-end">
            <div class="col-md-4">
              <label class="form-label">Item Name</label>
              <input type="text" class="form-control" id="itemName">
            </div>
            <div class="col-md-3">
              <label class="form-label">Quantity</label>
              <input type="number" class="form-control" id="itemQty" min="1" value="1">
            </div>
            <div class="col-md-3 form-check d-flex align-items-center">
              <input class="form-check-input me-2" type="checkbox" id="itemOrganic">
              <label class="form-check-label" for="itemOrganic">Organic</label>
            </div>
            <div class="col-md-2">
              <button class="btn btn-secondary" type="button" id="addItemBtn">Add Item</button>
            </div>
          </div>
          <ul class="list-group mt-3" id="itemList"></ul>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" data-i18n-key="close">Close</button>
          <button type="button" class="btn btn-primary" id="saveOrderBtn" data-i18n-key="save">Save</button>
        </div>
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/seed.js"></script>
  <script src="../js/common.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const ordersKey = 'purchaseOrders';
    const vendorsKey = 'vendors';
    let items = [];
    function loadOrders() {
      return JSON.parse(localStorage.getItem(ordersKey) || '[]');
    }
    function saveOrders(list) {
      localStorage.setItem(ordersKey, JSON.stringify(list));
    }
    function renderOrders() {
      const tbody = document.getElementById('purchaseTableBody');
      tbody.innerHTML = '';
      const orders = loadOrders();
      orders.forEach((order, idx) => {
        const tr = document.createElement('tr');
        const organicFlag = order.items.every(it => it.organic);
        const itemsString = order.items.map(it => it.name + ' (' + it.qty + (it.organic ? ' O' : '') + ')').join(', ');
        tr.innerHTML = `<td>${idx + 1}</td><td>${order.vendor}</td><td>${order.date}</td><td>${itemsString}</td><td>${organicFlag ? 'Yes' : 'Mixed'}</td>`;
        tbody.appendChild(tr);
      });
    }
    function loadVendors() {
      return JSON.parse(localStorage.getItem(vendorsKey) || '[]');
    }
    function populateVendorSelect() {
      const select = document.getElementById('poVendor');
      select.innerHTML = '';
      const vendors = loadVendors();
      vendors.forEach(v => {
        const option = document.createElement('option');
        option.value = v.name;
        option.textContent = v.name;
        select.appendChild(option);
      });
    }
    // Add item to list
    document.getElementById('addItemBtn').addEventListener('click', () => {
      const name = document.getElementById('itemName').value.trim();
      const qty = parseInt(document.getElementById('itemQty').value, 10);
      const organic = document.getElementById('itemOrganic').checked;
      if (!name || qty <= 0) return;
      items.push({name, qty, organic});
      renderItems();
      document.getElementById('itemName').value = '';
      document.getElementById('itemQty').value = 1;
      document.getElementById('itemOrganic').checked = false;
    });
    function renderItems() {
      const listEl = document.getElementById('itemList');
      listEl.innerHTML = '';
      items.forEach((it, idx) => {
        const li = document.createElement('li');
        li.className = 'list-group-item d-flex justify-content-between align-items-center';
        li.textContent = `${it.name} ‚Äì ${it.qty}${it.organic ? ' (Organic)' : ''}`;
        const btn = document.createElement('button');
        btn.className = 'btn btn-sm btn-danger';
        btn.textContent = '√ó';
        btn.onclick = () => {
          items.splice(idx, 1);
          renderItems();
        };
        li.appendChild(btn);
        listEl.appendChild(li);
      });
    }
    document.getElementById('saveOrderBtn').addEventListener('click', () => {
      const vendor = document.getElementById('poVendor').value;
      const date = document.getElementById('poDate').value;
      if (!vendor || !date || items.length === 0) return;
      const orders = loadOrders();
      orders.push({vendor, date, items: items.slice()});
      saveOrders(orders);
      items = [];
      renderOrders();
      renderItems();
      var modal = bootstrap.Modal.getInstance(document.getElementById('poModal'));
      modal.hide();
    });
    // When modal is shown, load vendors and reset items
    document.getElementById('poModal').addEventListener('show.bs.modal', () => {
      populateVendorSelect();
      items = [];
      renderItems();
      document.getElementById('poDate').value = '';
    });
    renderOrders();
  });
  </script>
</body>
</html>

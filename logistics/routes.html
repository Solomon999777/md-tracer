<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-i18n-key="routes-title">Route Planning</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .stop-row { margin-bottom: 0.5rem; }
  </style>
</head>
<body>
  <!-- Language selector and voice command -->
  <div class="container py-2 d-flex justify-content-end">
    <select id="langSelector" class="form-select form-select-sm w-auto me-2">
      <option value="en">English</option>
      <option value="ru">–†—É—Å—Å–∫–∏–π</option>
      <option value="he">◊¢◊ë◊®◊ô◊™</option>
    </select>
    <button class="btn btn-outline-primary btn-sm" onclick="startVoiceCommand()">üé§ Voice</button>
  </div>
  <div class="container py-4">
    <h1 class="mb-4" data-i18n-key="routes-title">Route Planning</h1>
    <form id="routeForm">
      <div class="mb-3">
        <label for="origin" class="form-label" data-i18n-key="origin-address">Starting Location</label>
        <input type="text" id="origin" class="form-control" placeholder="Enter starting location" required>
      </div>
      <div class="mb-3">
        <label for="destination" class="form-label" data-i18n-key="destination-address">Destination</label>
        <input type="text" id="destination" class="form-control" placeholder="Enter destination" required>
      </div>
      <div id="stopsContainer" class="mb-3">
        <label class="form-label" data-i18n-key="stop-address">Stop Address</label>
      </div>
      <button type="button" class="btn btn-secondary mb-3" id="addStopBtn" data-i18n-key="add-stop">Add Stop</button>
      <div class="mb-3">
        <button type="button" class="btn btn-primary" id="buildRouteBtn" data-i18n-key="build-route">Build Route</button>
      </div>
    </form>
    <div id="routeResult" class="mt-4" style="display:none;">
      <h5 data-i18n-key="generated-link">Generated Route Link</h5>
      <div class="input-group">
        <input type="text" id="routeLink" class="form-control" readonly>
        <button class="btn btn-outline-secondary" type="button" id="copyLinkBtn" data-i18n-key="copy-link">Copy Link</button>
      </div>
      <div class="mt-2">
        <a href="#" class="btn btn-success me-2" target="_blank" id="openGoogleBtn" data-i18n-key="open-google">Open in Google Maps</a>
        <a href="#" class="btn btn-info" target="_blank" id="openWazeBtn" data-i18n-key="open-waze">Open in Waze</a>
      </div>
    </div>
    <a href="index.html" class="btn btn-secondary mt-4" data-i18n-key="close">Back</a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="../js/common.js"></script>
  <script>
    function addStopRow(value = '') {
      const container = document.getElementById('stopsContainer');
      const row = document.createElement('div');
      row.className = 'input-group stop-row';
      row.innerHTML = '<input type="text" class="form-control stop-input" placeholder="Enter stop address" value="' + value + '">' +
                      '<button type="button" class="btn btn-outline-danger" onclick="this.parentElement.remove()">&times;</button>';
      container.appendChild(row);
    }
    document.getElementById('addStopBtn').addEventListener('click', () => addStopRow());
    document.getElementById('buildRouteBtn').addEventListener('click', () => {
      const origin = document.getElementById('origin').value.trim();
      const destination = document.getElementById('destination').value.trim();
      if (!origin || !destination) {
        alert('Please enter start and destination');
        return;
      }
      const stops = Array.from(document.querySelectorAll('.stop-input'))
        .map(input => input.value.trim())
        .filter(addr => addr);
      const baseUrl = 'https://www.google.com/maps/dir/?api=1';
      let url = baseUrl + '&origin=' + encodeURIComponent(origin) + '&destination=' + encodeURIComponent(destination);
      if (stops.length > 0) {
        url += '&waypoints=' + encodeURIComponent(stops.join('|'));
      }
      url += '&travelmode=driving';
      document.getElementById('routeLink').value = url;
      document.getElementById('openGoogleBtn').href = url;
      const wazeUrl = 'https://waze.com/ul?q=' + encodeURIComponent(destination) + '&navigate=yes';
      document.getElementById('openWazeBtn').href = wazeUrl;
      document.getElementById('routeResult').style.display = 'block';
    });
    document.getElementById('copyLinkBtn').addEventListener('click', () => {
      const url = document.getElementById('routeLink').value;
      navigator.clipboard.writeText(url).then(() => {
        alert('Link copied to clipboard');
      });
    });
    // Initialize with one stop row
    addStopRow();
  </script>
</body>
</html>
